<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualizador de Excel con Gr√°ficos</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
        }

        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .upload-area {
            border: 3px dashed #667eea;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            transition: all 0.3s ease;
            cursor: pointer;
            margin-bottom: 30px;
        }

        .upload-area:hover {
            border-color: #764ba2;
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.3);
        }

        .upload-area.dragover {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.2) 0%, rgba(118, 75, 162, 0.2) 100%);
            transform: scale(1.02);
        }

        #fileInput {
            display: none;
        }

        .upload-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .upload-text {
            color: #666;
            font-size: 18px;
            margin-bottom: 10px;
        }

        .upload-subtext {
            color: #999;
            font-size: 14px;
        }

        .controls {
            display: none;
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .control-group {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        label {
            font-weight: 600;
            color: #555;
            min-width: 120px;
        }

        select {
            flex: 1;
            padding: 10px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: white;
            cursor: pointer;
            min-width: 200px;
        }

        select:hover {
            border-color: #667eea;
        }

        select:focus {
            outline: none;
            border-color: #764ba2;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .chart-container {
            position: relative;
            height: 500px;
            margin-top: 30px;
            padding: 20px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .chart-container.active {
            display: block;
        }

        .data-preview {
            display: none;
            margin-top: 30px;
            overflow-x: auto;
            animation: fadeIn 0.5s ease;
        }

        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        }

        th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        td {
            padding: 12px 15px;
            border-bottom: 1px solid #f0f0f0;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .info-panel {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            border-left: 4px solid #667eea;
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .info-panel.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .info-text {
            color: #666;
            font-size: 14px;
        }

        .chart-type-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .chart-type-btn {
            padding: 8px 20px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .chart-type-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: transparent;
        }

        .chart-type-btn:hover:not(.active) {
            border-color: #667eea;
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìä Visualizador de Excel con Gr√°ficos</h1>
        
        <div class="upload-area" id="uploadArea">
            <div class="upload-icon">üìÅ</div>
            <div class="upload-text">Arrastra tu archivo Excel aqu√≠</div>
            <div class="upload-subtext">o haz clic para seleccionar</div>
            <input type="file" id="fileInput" accept=".xlsx,.xls">
        </div>

        <div class="info-panel" id="infoPanel">
            <div class="info-text">
                <strong>Archivo cargado:</strong> <span id="fileName"></span> | 
                <strong>Hojas encontradas:</strong> <span id="sheetCount"></span>
            </div>
        </div>

        <div class="controls" id="controls">
            <div class="control-group">
                <label>Hoja de Excel:</label>
                <select id="sheetSelect">
                    <option value="">Selecciona una hoja</option>
                </select>
            </div>

            <div class="chart-type-selector">
                <button class="chart-type-btn active" data-type="bar">Barras</button>
                <button class="chart-type-btn" data-type="line">L√≠neas</button>
                <button class="chart-type-btn" data-type="pie">Circular</button>
                <button class="chart-type-btn" data-type="doughnut">Dona</button>
                <button class="chart-type-btn" data-type="radar">Radar</button>
                <button class="chart-type-btn" data-type="polarArea">√Årea Polar</button>
            </div>

            <div class="control-group">
                <label>Eje X (Etiquetas):</label>
                <select id="xAxis">
                    <option value="">Selecciona columna</option>
                </select>
            </div>

            <div class="control-group">
                <label>Eje Y (Valores):</label>
                <select id="yAxis" multiple style="height: 100px;">
                    <option value="">Selecciona columnas (puedes elegir varias)</option>
                </select>
            </div>

            <button id="generateChart" disabled>Generar Gr√°fico</button>
        </div>

        <div class="chart-container" id="chartContainer">
            <canvas id="myChart"></canvas>
        </div>

        <div class="data-preview" id="dataPreview">
            <h3 style="margin-bottom: 15px; color: #333;">Vista previa de datos (primeras 10 filas)</h3>
            <div id="tableContainer"></div>
        </div>
    </div>

    <script>
        let workbook = null;
        let currentData = null;
        let currentChart = null;
        let selectedChartType = 'bar';

        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const controls = document.getElementById('controls');
        const sheetSelect = document.getElementById('sheetSelect');
        const xAxis = document.getElementById('xAxis');
        const yAxis = document.getElementById('yAxis');
        const generateChart = document.getElementById('generateChart');
        const chartContainer = document.getElementById('chartContainer');
        const dataPreview = document.getElementById('dataPreview');
        const infoPanel = document.getElementById('infoPanel');

        // Configuraci√≥n de tipos de gr√°fico
        const chartTypeButtons = document.querySelectorAll('.chart-type-btn');
        chartTypeButtons.forEach(btn => {
            btn.addEventListener('click', function() {
                chartTypeButtons.forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                selectedChartType = this.dataset.type;
            });
        });

        // Manejo de carga de archivos
        uploadArea.addEventListener('click', () => fileInput.click());
        
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFile(e.target.files[0]);
            }
        });

        function handleFile(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    workbook = XLSX.read(e.target.result, { type: 'binary' });
                    
                    // Mostrar informaci√≥n del archivo
                    document.getElementById('fileName').textContent = file.name;
                    document.getElementById('sheetCount').textContent = workbook.SheetNames.length;
                    infoPanel.classList.add('active');
                    
                    // Llenar selector de hojas
                    sheetSelect.innerHTML = '<option value="">Selecciona una hoja</option>';
                    workbook.SheetNames.forEach(name => {
                        const option = document.createElement('option');
                        option.value = name;
                        option.textContent = name;
                        sheetSelect.appendChild(option);
                    });
                    
                    controls.style.display = 'block';
                    
                    // Auto-seleccionar primera hoja si solo hay una
                    if (workbook.SheetNames.length === 1) {
                        sheetSelect.value = workbook.SheetNames[0];
                        loadSheetData(workbook.SheetNames[0]);
                    }
                } catch (error) {
                    alert('Error al leer el archivo. Aseg√∫rate de que sea un archivo Excel v√°lido.');
                    console.error(error);
                }
            };
            reader.readAsBinaryString(file);
        }

        sheetSelect.addEventListener('change', (e) => {
            if (e.target.value) {
                loadSheetData(e.target.value);
            }
        });

        function loadSheetData(sheetName) {
            const worksheet = workbook.Sheets[sheetName];
            currentData = XLSX.utils.sheet_to_json(worksheet);
            
            if (currentData.length === 0) {
                alert('La hoja seleccionada no contiene datos.');
                return;
            }
            
            // Obtener columnas
            const columns = Object.keys(currentData[0]);
            
            // Llenar selectores de ejes
            xAxis.innerHTML = '<option value="">Selecciona columna</option>';
            yAxis.innerHTML = '';
            
            columns.forEach(col => {
                const optionX = document.createElement('option');
                optionX.value = col;
                optionX.textContent = col;
                xAxis.appendChild(optionX);
                
                const optionY = document.createElement('option');
                optionY.value = col;
                optionY.textContent = col;
                yAxis.appendChild(optionY);
            });
            
            // Mostrar vista previa de datos
            showDataPreview();
        }

        function showDataPreview() {
            const tableContainer = document.getElementById('tableContainer');
            const previewData = currentData.slice(0, 10);
            
            let tableHTML = '<table><thead><tr>';
            const columns = Object.keys(currentData[0]);
            
            columns.forEach(col => {
                tableHTML += `<th>${col}</th>`;
            });
            tableHTML += '</tr></thead><tbody>';
            
            previewData.forEach(row => {
                tableHTML += '<tr>';
                columns.forEach(col => {
                    tableHTML += `<td>${row[col] || ''}</td>`;
                });
                tableHTML += '</tr>';
            });
            
            tableHTML += '</tbody></table>';
            tableContainer.innerHTML = tableHTML;
            dataPreview.style.display = 'block';
        }

        xAxis.addEventListener('change', checkIfCanGenerate);
        yAxis.addEventListener('change', checkIfCanGenerate);

        function checkIfCanGenerate() {
            const selectedY = Array.from(yAxis.selectedOptions).map(option => option.value);
            generateChart.disabled = !(xAxis.value && selectedY.length > 0 && selectedY[0] !== '');
        }

        generateChart.addEventListener('click', () => {
            const xColumn = xAxis.value;
            const yColumns = Array.from(yAxis.selectedOptions).map(option => option.value);
            
            if (!xColumn || yColumns.length === 0) {
                alert('Por favor selecciona columnas para ambos ejes.');
                return;
            }
            
            generateChartFromData(xColumn, yColumns);
        });

        function generateChartFromData(xColumn, yColumns) {
            const labels = currentData.map(row => row[xColumn]);
            
            // Colores vibrantes para m√∫ltiples series
            const colors = [
                'rgba(102, 126, 234, 0.8)',
                'rgba(118, 75, 162, 0.8)',
                'rgba(255, 99, 132, 0.8)',
                'rgba(54, 162, 235, 0.8)',
                'rgba(255, 206, 86, 0.8)',
                'rgba(75, 192, 192, 0.8)',
                'rgba(153, 102, 255, 0.8)',
                'rgba(255, 159, 64, 0.8)'
            ];
            
            const borderColors = colors.map(c => c.replace('0.8', '1'));
            
            const datasets = yColumns.map((col, index) => {
                const data = currentData.map(row => {
                    const value = parseFloat(row[col]);
                    return isNaN(value) ? 0 : value;
                });
                
                return {
                    label: col,
                    data: data,
                    backgroundColor: colors[index % colors.length],
                    borderColor: borderColors[index % borderColors.length],
                    borderWidth: 2,
                    tension: 0.3
                };
            });
            
            // Si hay un gr√°fico anterior, destruirlo
            if (currentChart) {
                currentChart.destroy();
            }
            
            const ctx = document.getElementById('myChart').getContext('2d');
            
            // Configuraci√≥n espec√≠fica seg√∫n el tipo de gr√°fico
            let options = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                        labels: {
                            padding: 15,
                            font: {
                                size: 14
                            }
                        }
                    },
                    tooltip: {
                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                        padding: 12,
                        cornerRadius: 8,
                        titleFont: {
                            size: 14
                        },
                        bodyFont: {
                            size: 13
                        }
                    }
                }
            };
            
            // Ajustes espec√≠ficos para cada tipo de gr√°fico
            if (selectedChartType === 'line') {
                datasets.forEach(dataset => {
                    dataset.fill = false;
                    dataset.pointRadius = 4;
                    dataset.pointHoverRadius = 6;
                });
                options.scales = {
                    y: {
                        beginAtZero: true,
                        grid: {
                            color: 'rgba(0, 0, 0, 0.05)'
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        }
                    }
                };
            } else if (selectedChartType === 'bar') {
                options.scales = {
                    y: {
                        beginAtZero: true,
                        grid: {
                            color: 'rgba(0, 0, 0, 0.05)'
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        }
                    }
                };
            } else if (selectedChartType === 'radar') {
                options.scales = {
                    r: {
                        beginAtZero: true,
                        grid: {
                            color: 'rgba(0, 0, 0, 0.1)'
                        }
                    }
                };
            } else if (selectedChartType === 'polarArea') {
                // Para gr√°ficos de √°rea polar, usar solo la primera serie
                datasets.splice(1);
                options.scales = {
                    r: {
                        beginAtZero: true
                    }
                };
            } else if (selectedChartType === 'pie' || selectedChartType === 'doughnut') {
                // Para gr√°ficos circulares, usar solo la primera serie
                datasets.splice(1);
                datasets[0].backgroundColor = labels.map((_, i) => colors[i % colors.length]);
                datasets[0].borderColor = labels.map((_, i) => borderColors[i % borderColors.length]);
            }
            
            currentChart = new Chart(ctx, {
                type: selectedChartType,
                data: {
                    labels: labels,
                    datasets: datasets
                },
                options: options
            });
            
            chartContainer.classList.add('active');
            chartContainer.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
    </script>
</body>
</html>
